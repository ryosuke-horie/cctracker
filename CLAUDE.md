# CLAUDE.md

## プロジェクト概要

CLAUDE CODE専用のClaude MaxプランのRate Limitの可視化を行うCLIツールです。
Claude使用量の監視、プラン自動判定、多言語対応など、開発者の生産性向上を支援します。

このツールは、Claude APIの使用量制限を効率的に管理し、開発者がClaude Codeを最大限活用できるよう設計されています。
プラン自動判定により、MaxプランとProプランを使用履歴から自動で識別し、適切な使用量監視を提供します。
リアルタイムでの監視機能により、Rate Limitに達する前に警告を表示し、開発フローの中断を防ぎます。
日本語と英語の両方に対応し、グローバルな開発チームでの利用を想定した設計となっています。

cctracker は企業レベルでの Claude 使用量管理から個人開発者のプロジェクト最適化まで、幅広いシナリオに対応しています。
継続的な監視により、使用量の急激な増加を事前に検知し、プロジェクトの予算管理や開発リソース配分の意思決定に貢献します。
また、詳細な使用統計レポート機能により、チームの Claude 活用パターンを分析し、より効率的な開発フローの構築を支援します。

### 主要機能
- **Rate Limit監視**: Claude使用量のリアルタイム追跡と制限値の可視化
- **プラン自動判定**: 使用履歴からClaude MaxプランとProプランを自動識別
- **多言語対応**: `--ja`オプションで日本語表示、グローバル開発チーム対応
- **CLI化**: `npx cctracker`として簡単実行、npm公開済み
- **Watch機能**: 継続的な使用量監視とアラート通知

### 利用場面
- **開発チーム**: チーム全体のClaude使用量管理と最適化
- **個人開発者**: 個人のRate Limit管理と効率的な開発フロー維持
- **プロジェクト管理**: 大規模プロジェクトでのClaude使用量予算管理
- **CI/CD**: 自動化パイプラインでのClaude使用量監視

### 技術スタック
- **言語**: TypeScript（Node.js 18+）厳格な型チェック、完全型安全実装
- **モジュール**: ESM（ES Modules）現代的なモジュールシステム、Tree Shaking対応
- **品質管理**: Biome v2.1.1、TDD原則、継続的品質向上、any型禁止ポリシー
- **テストカバレッジ**: 89.49%（102テスト）包括的なテストスイート、回帰テスト完備

### 開発における利点
このツールを導入することで、Claude使用量の透明性が向上し、開発チーム全体の生産性が大幅に改善されます。
Rate Limitの予期しない到達によるプロジェクトの停滞を防ぎ、計画的な開発スケジュール管理が可能になります。
また、プラン最適化の判断材料として詳細な使用量データを提供し、コスト効率の最大化に貢献します。

## 開発ルール

### コード品質管理
- **Biome v2.1.1**: デフォルトルールに準拠、例外設定却下
- **any型の使用を禁止**: テストコードを含む全てのコードでanyの使用を厳格に禁止
- **Node.js imports**: 組み込みモジュールには`node:`プレフィックスを必須
- **型安全性**: モックやテストユーティリティにも適切な型定義を作成

### 品質保証チェックリスト
- [ ] TDDサイクルで実装
- [ ] 型定義はanyを使用せず適切に定義
- [ ] テストカバレッジ89%以上維持
- [ ] Biomeチェック全項目通過
- [ ] 既存テストの回帰確認

### 機能別開発ガイド
- **パフォーマンス最適化**: Rate Limit判定の高速化
- **メモリ管理**: 大量データ処理時の効率的なメモリ使用
- **エラーハンドリング**: ネットワークエラーや認証エラーの適切な処理
- **ログ管理**: デバッグとトラブルシューティングのための詳細ログ

### 開発時コマンド
```bash
# 開発モード
npm run dev           # 英語で実行
npm run dev -- --ja   # 日本語で実行

# 品質チェック
npm run lint          # リント実行
npm run typecheck     # TypeScript型チェック
npm run format        # フォーマット
npm run check         # 全体チェック
npm run check:fix     # 全体チェック + 自動修正
```

### 国際化（i18n）対応
- **日本語オプション**: `--ja`オプションで全メッセージを日本語表示
- **メッセージ管理**: `src/i18n/messages.ts`で一元管理
- **型安全性**: `Locale`型を使用して言語指定を型チェック

## テスト要件

### カバレッジ目標
- **目標値**: 89%以上を維持
- **測定**: v8 coverageを使用
- **CI**: カバレッジが下回った場合はマージ禁止

### TDD原則
- **Red-Green-Refactor**: サイクルを厳密に実施
- **単体テスト**: 新機能・バグ修正には必ずテストを追加
- **モック戦略**: 外部依存はVitest mockingで分離

### テストファイル構成
```typescript
// ❌ 悪い例
vi.spyOn(instance as any, 'privateMethod')

// ✅ 良い例
type InstanceWithPrivateMethods = Instance & {
  privateMethod: (param: unknown) => unknown;
};
vi.spyOn(instance as InstanceWithPrivateMethods, 'privateMethod')
```

## CI/CD

### Push前チェック（Husky）
git push時に以下が自動実行されます：
- **Lint**: `npm run lint`
- **型チェック**: `npm run typecheck`
- **テスト**: `npm run test:run`

**重要**: `--no-verify`オプションを使用したチェックのバイパスは厳禁です。

### GitHub Actions CI
- **トリガー**: PRの作成・更新時、mainブランチpush時
- **実行内容**:
  - TypeScript型チェック (`npm run typecheck`)
  - Biomeチェック (`npm run check`)
  - ビルドチェック (`npm run build`)
  - テスト実行 (`npm run test:run`)
- **結果報告**: CIの実行結果をPRコメントに自動投稿

## Git運用

### コミットメッセージ
```
{prefix}: {issue番号} {変更内容の日本語説明}

例：
feat: issue-1 Claude token監視機能を追加
fix: issue-2 プログレスバーの計算エラーを修正
chore: issue-3 Biome設定をv2.1.1に更新
```

### ブランチ戦略
- **命名**: `{prefix}/{issue番号}`
- **例**: `feat/issue-1`, `fix/issue-2`, `chore/issue-3`

### PR要件
- **タイトル**: `{prefix}: issue-{番号} {概要}`
- **本文**: Issue番号を関連付け、自動クローズ設定
- **マージ条件**: 全CIチェック通過が必須

## アーキテクチャ

### システム構成
- **Node.js**: v18以上を必須要件
- **ESM**: モダンなモジュールシステム
- **TypeScript**: 厳格な型チェック（any型禁止）
- **Biome**: v2.1.1によるリント・フォーマット統一

### ディレクトリ構造
```
src/
├── core/           # コア機能（Rate Limit判定、プラン検出）
├── cli/            # CLI インターフェース
├── i18n/           # 国際化メッセージ
├── utils/          # ユーティリティ関数
└── types/          # TypeScript型定義
```

## ドキュメント生成ルール

docs以下に仕様書を作っていきます。
docs/README.mdを目次として辿れるようにし、実装に合わせてメンテナンスしていく。